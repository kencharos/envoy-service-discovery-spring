version: '2'
services:
  front-app:
    build:
      context: ./front
    image: front-app:latest
    container_name: front-app
    environment: #envoyのegressをさす
      - "GRPC_BACKEND1_HOST=front-proxy"
      - "GRPC_BACKEND1_PORT=8000"
      - "GRPC_BACKEND2_HOST=front-proxy"
      - "GRPC_BACKEND2_PORT=8000"
    ports:
      - "8080:8080"
  front-proxy:
    build:
      context: ./front-proxy
    image: front-proxy:latest
    container_name: front-proxy
    ports:
      - "3000:3000"
      - "8000:8000"
      - "10001:10001"
  backend1-app:
    build:
      context: ./backend1
    image: backend1-app:latest
    container_name: backend1-app
    environment:
      - "GRPC_BACKEND2_HOST=backend2-app"
      - "GRPC_BACKEND2_PORT=6567"
    ports:
      - "8081:8081"
      - "6566:6566"
  backend2-app:
    build:
      context: ./backend2
    image: backend2-app:latest
    container_name: backend2-app
    ports:
      - "8082:8082"
      - "6567:6567"
